<view class="container">
  <!-- 基础信息表单 -->
  <view class="form-section">
    <view class="form-item">
      <text class="label">行业</text>
      <view class="picker-container">
        <picker bindchange="onIndustryChange" value="{{industryIndex}}" range="{{industries}}">
          <view class="picker">{{industries[industryIndex]}}</view>
        </picker>
        <view class="apply-industry-btn" bindtap="showIndustryApply">申请新行业</view>
      </view>
    </view>
    <view class="form-item">
      <text class="label">平台</text>
      <picker bindchange="onPlatformChange" value="{{platformIndex}}" range="{{platforms}}">
        <view class="picker">{{platforms[platformIndex]}}</view>
      </picker>
    </view>
    <view class="form-item">
      <text class="label">日期</text>
      <picker mode="date" value="{{date}}" bindchange="onDateChange">
        <view class="picker">{{date}}</view>
      </picker>
    </view>
  </view>

  <!-- 申请新行业弹窗 -->
  <view class="modal" wx:if="{{showIndustryApplyModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">申请新行业</text>
        <view class="modal-close" bindtap="closeIndustryApply">×</view>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="label">行业名称</text>
          <input class="input" placeholder="请输入行业名称" value="{{newIndustryName}}" bindinput="onNewIndustryNameInput" />
        </view>
        <view class="form-item">
          <text class="label">行业描述</text>
          <textarea class="textarea" placeholder="请简要描述该行业的工作内容" value="{{newIndustryDescription}}" bindinput="onNewIndustryDescriptionInput"></textarea>
        </view>
        <view class="form-item">
          <text class="label">平台名称</text>
          <textarea class="textarea" placeholder="请输入平台名称，多个平台用、分隔" value="{{newPlatformNames}}" bindinput="onNewPlatformNamesInput"></textarea>
        </view>
        <view class="modal-tips">
          <text>提交申请后，我们将尽快审核并添加新行业。</text>
          <text>审核通过后，新行业和对应平台将自动添加到选项中。</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn-cancel" bindtap="closeIndustryApply">取消</button>
        <button class="btn-confirm" bindtap="submitIndustryApply">提交申请</button>
      </view>
    </view>
  </view>

  <!-- 时间段列表 -->
  <view class="time-slots-section">
    <view class="section-header">
      <text class="title">工作时间段</text>
      <view class="add-btn" bindtap="addTimeSlot">
        <text class="add-icon">+</text>
        <text>新增时段</text>
      </view>
    </view>

    <view class="time-slots-list">
      <view class="time-slot-item" wx:for="{{timeSlots}}" wx:key="index">
        <view class="time-inputs">
          <picker mode="time" value="{{item.startTime}}" bindchange="onStartTimeChange" data-index="{{index}}">
            <view class="time-picker">{{item.startTime}}</view>
          </picker>
          <text class="separator">至</text>
          <picker mode="time" value="{{item.endTime}}" bindchange="onEndTimeChange" data-index="{{index}}">
            <view class="time-picker">{{item.endTime}}</view>
          </picker>
        </view>
        <view class="input-group">
          <view class="income-input">
            <text class="currency">¥</text>
            <input type="digit" 
                   value="{{item.income}}" 
                   placeholder="收入" 
                   bindinput="onIncomeInput" 
                   data-index="{{index}}"
                   maxlength="10"/>
          </view>
          <view class="orders-input">
            <input type="number" 
                   value="{{item.orders}}" 
                   placeholder="完单量" 
                   bindinput="onOrdersInput" 
                   data-index="{{index}}"
                   maxlength="5"/>
          </view>
          <view class="delete-btn" bindtap="deleteTimeSlot" data-index="{{index}}">
            <text class="delete-icon">×</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 空状态提示 -->
    <view class="empty-state" wx:if="{{timeSlots.length === 0}}">
      <image class="empty-icon" src="/images/empty.svg" mode="aspectFit"></image>
      <text class="empty-text">点击添加第一个时段</text>
    </view>
  </view>

  <!-- 数据展示区域 -->
  <view class="data-section">
    <view class="data-grid">
      <view class="data-item">
        <text class="data-label">总时长</text>
        <text class="data-value">{{totalHours}}小时</text>
      </view>
      <view class="data-item">
        <text class="data-label">总收入</text>
        <text class="data-value income">¥{{totalIncome}}</text>
      </view>
      <view class="data-item">
        <text class="data-label">平均时薪</text>
        <text class="data-value">¥{{averageHourlyRate}}/h</text>
      </view>
      <view class="data-item">
        <text class="data-label">跑单数</text>
        <text class="data-value orders">{{totalOrders}}单</text>
      </view>
      <view class="data-item">
        <text class="data-label">平均单价</text>
        <text class="data-value">¥{{averageOrderPrice}}/单</text>
      </view>
    </view>
  </view>

  <!-- 保存按钮 -->
  <button class="save-btn" bindtap="saveRecord">保存记录</button>

  <!-- 历史记录 -->
  <view class="history-section">
    <view class="section-title">历史记录</view>
    <view class="history-list">
      <view class="history-item" wx:for="{{historyRecords}}" wx:key="index">
        <view class="history-header">
          <text class="history-date">{{item.date}}</text>
          <text class="history-platform">{{item.platform}}</text>
        </view>
        <view class="history-content">
          <view class="history-row">
            <text>工作时段：{{item.timeSlots[0].startTime}} - {{item.timeSlots[item.timeSlots.length-1].endTime}}</text>
          </view>
          <view class="history-row">
            <text>总收入：¥{{item.totalIncome}}</text>
            <text>跑单数：{{item.orders}}单</text>
          </view>
          <view class="history-row">
            <text>平均时薪：¥{{item.averageHourlyRate}}/h</text>
          </view>
          <!-- 编辑模式下的行业和平台选择器 -->
          <view class="history-edit-form" wx:if="{{isEditing && editingIndex === index}}">
            <view class="history-edit-item">
              <text class="history-edit-label">行业：</text>
              <picker bindchange="onIndustryChange" value="{{industryIndex}}" range="{{industries}}">
                <view class="history-edit-picker">{{industries[industryIndex]}}</view>
              </picker>
            </view>
            <view class="history-edit-item">
              <text class="history-edit-label">平台：</text>
              <picker bindchange="onPlatformChange" value="{{platformIndex}}" range="{{platforms}}">
                <view class="history-edit-picker">{{platforms[platformIndex]}}</view>
              </picker>
            </view>
          </view>
        </view>
        <view class="record-actions">
          <button class="edit-btn" bindtap="{{isEditing && editingIndex === index ? 'saveRecord' : 'editRecord'}}" data-index="{{index}}" data-record="{{item}}">
            {{isEditing && editingIndex === index ? '保存' : '编辑'}}
          </button>
          <button class="delete-btn" bindtap="deleteHistoryRecord" data-index="{{index}}">删除</button>
        </view>
      </view>
    </view>
  </view>
</view> 